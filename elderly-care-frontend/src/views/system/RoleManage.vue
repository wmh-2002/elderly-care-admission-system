<template>\n  <div class=\"role-manage\">\n    <div class=\"page-header\">\n      <h2>角色管理</h2>\n      <el-button type=\"primary\" @click=\"handleAdd\" :icon=\"Plus\">新增角色</el-button>\n    </div>\n    \n    <!-- 搜索和筛选区域 -->\n    <el-card class=\"search-card\">\n      <el-form :model=\"searchForm\" inline>\n        <el-form-item label=\"角色名称\">\n          <el-input v-model=\"searchForm.roleName\" placeholder=\"请输入角色名称\" clearable />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"handleSearch\" :icon=\"Search\">搜索</el-button>\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n    \n    <!-- 表格 -->\n    <el-card class=\"table-card\">\n      <template #header>\n        <div class=\"table-header\">\n          <span>角色列表 ({{ total }})</span>\n        </div>\n      </template>\n      \n      <el-table \n        :data=\"roleList\" \n        v-loading=\"loading\"\n        style=\"width: 100%\"\n        row-key=\"id\"\n      >\n        <el-table-column type=\"index\" width=\"60\" />\n        <el-table-column prop=\"roleName\" label=\"角色名称\" width=\"150\" />\n        <el-table-column prop=\"remark\" label=\"角色描述\" min-width=\"200\" />\n        <el-table-column prop=\"userCount\" label=\"用户数量\" width=\"100\" />\n        <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"150\" />\n        <el-table-column label=\"操作\" width=\"200\" fixed=\"right\">\n          <template #default=\"{ row }\">\n            <el-button \n              size=\"small\" \n              @click=\"handleView(row)\"\n            >\n              查看\n            </el-button>\n            <el-button \n              size=\"small\" \n              type=\"primary\" \n              @click=\"handleEdit(row)\"\n            >\n              编辑\n            </el-button>\n            <el-button \n              size=\"small\" \n              type=\"danger\" \n              @click=\"handleDelete(row)\"\n            >\n              删除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      \n      <!-- 分页 -->\n      <div class=\"pagination-container\">\n        <el-pagination\n          v-model:current-page=\"pagination.page\"\n          v-model:page-size=\"pagination.size\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          :total=\"total\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n    </el-card>\n    \n    <!-- 编辑/新增弹窗 -->\n    <el-dialog \n      :title=\"dialogTitle\" \n      v-model=\"dialogVisible\" \n      width=\"50%\" \n      :before-close=\"handleDialogClose\"\n    >\n      <el-form \n        :model=\"roleForm\" \n        :rules=\"roleRules\" \n        ref=\"roleFormRef\"\n        label-width=\"120px\"\n      >\n        <el-form-item label=\"角色名称\" prop=\"roleName\">\n          <el-input v-model=\"roleForm.roleName\" placeholder=\"请输入角色名称\" />\n        </el-form-item>\n        \n        <el-form-item label=\"角色描述\" prop=\"remark\">\n          <el-input \n            v-model=\"roleForm.remark\" \n            type=\"textarea\" \n            :rows=\"4\"\n            placeholder=\"请输入角色描述\"\n          />\n        </el-form-item>\n      </el-form>\n      \n      <template #footer>\n        <div class=\"dialog-footer\">\n          <el-button @click=\"handleDialogClose\">取消</el-button>\n          <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"submitting\">确定</el-button>\n        </div>\n      </template>\n    </el-dialog>\n    \n    <!-- 角色详情弹窗 -->\n    <el-drawer v-model=\"detailVisible\" title=\"角色详情\" size=\"40%\">\n      <div v-if=\"currentRole\" class=\"role-detail\">\n        <el-descriptions :column=\"1\" border>\n          <el-descriptions-item label=\"角色名称\">{{ currentRole.roleName }}</el-descriptions-item>\n          <el-descriptions-item label=\"角色描述\">{{ currentRole.remark }}</el-descriptions-item>\n          <el-descriptions-item label=\"用户数量\">{{ currentRole.userCount }}</el-descriptions-item>\n          <el-descriptions-item label=\"创建时间\">{{ currentRole.createTime }}</el-descriptions-item>\n        </el-descriptions>\n        \n        <h3 style=\"margin-top: 20px;\">权限分配</h3>\n        <el-tree\n          :data=\"permissionTree\"\n          :props=\"treeProps\"\n          node-key=\"id\"\n          show-checkbox\n          :default-checked-keys=\"currentRole.permissions || []\"\n          style=\"margin-top: 10px;\"\n        />\n      </div>\n    </el-drawer>\n  </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted } from 'vue'\nimport { \n  Plus, \n  Search, \n  Edit, \n  Delete, \n  View,\n  User,\n  Monitor\n} from '@element-plus/icons-vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\n\nexport default {\n  name: 'RoleManage',\n  setup() {\n    // 搜索表单\n    const searchForm = reactive({\n      roleName: ''\n    })\n    \n    // 分页信息\n    const pagination = reactive({\n      page: 1,\n      size: 10,\n      total: 0\n    })\n    \n    // 表格数据\n    const loading = ref(false)\n    const roleList = ref([])\n    const total = ref(0)\n    \n    // 弹窗相关\n    const dialogVisible = ref(false)\n    const dialogTitle = ref('')\n    const detailVisible = ref(false)\n    const submitting = ref(false)\n    const isEdit = ref(false)\n    \n    // 表单数据\n    const roleForm = reactive({\n      id: null,\n      roleName: '',\n      remark: ''\n    })\n    \n    // 表单验证规则\n    const roleRules = {\n      roleName: [\n        { required: true, message: '请输入角色名称', trigger: 'blur' },\n        { min: 2, max: 20, message: '角色名称长度应在2-20个字符之间', trigger: 'blur' }\n      ]\n    }\n    \n    const roleFormRef = ref(null)\n    \n    // 当前查看的角色\n    const currentRole = ref(null)\n    \n    // 权限树数据\n    const permissionTree = ref([\n      {\n        id: 1,\n        label: '老人管理',\n        children: [\n          { id: 11, label: '老人档案查看' },\n          { id: 12, label: '老人档案新增' },\n          { id: 13, label: '老人档案编辑' },\n          { id: 14, label: '老人档案删除' }\n        ]\n      },\n      {\n        id: 2,\n        label: '房间床位',\n        children: [\n          { id: 21, label: '房间管理' },\n          { id: 22, label: '床位管理' }\n        ]\n      },\n      {\n        id: 3,\n        label: '护理管理',\n        children: [\n          { id: 31, label: '护理记录查看' },\n          { id: 32, label: '护理记录新增' },\n          { id: 33, label: '护理计划管理' }\n        ]\n      },\n      {\n        id: 4,\n        label: '费用管理',\n        children: [\n          { id: 41, label: '费用账单查看' },\n          { id: 42, label: '费用账单新增' },\n          { id: 43, label: '费用账单编辑' }\n        ]\n      },\n      {\n        id: 5,\n        label: '系统管理',\n        children: [\n          { id: 51, label: '用户管理' },\n          { id: 52, label: '角色管理' },\n          { id: 53, label: '系统设置' }\n        ]\n      }\n    ])\n    \n    const treeProps = {\n      children: 'children',\n      label: 'label'\n    }\n    \n    // 模拟获取角色列表\n    const getRoleList = () => {\n      loading.value = true\n      \n      // 模拟API请求延迟\n      setTimeout(() => {\n        // 生成模拟数据\n        const mockData = [\n          {\n            id: 1,\n            roleName: '系统管理员',\n            remark: '拥有系统所有权限，可以管理所有功能模块',\n            userCount: 1,\n            createTime: '2024-01-01 10:00:00',\n            permissions: [1, 11, 12, 13, 14, 2, 21, 22, 3, 31, 32, 33, 4, 41, 42, 43, 5, 51, 52, 53]\n          },\n          {\n            id: 2,\n            roleName: '院长',\n            remark: '可以查看各类统计报表，决策支持',\n            userCount: 2,\n            createTime: '2024-01-02 10:00:00',\n            permissions: [1, 11, 2, 21, 22, 3, 31, 4, 41, 5, 53]\n          },\n          {\n            id: 3,\n            roleName: '护理主管',\n            remark: '管理护理人员和护理记录，制定护理计划',\n            userCount: 3,\n            createTime: '2024-01-03 10:00:00',\n            permissions: [1, 11, 3, 31, 32, 33]\n          },\n          {\n            id: 4,\n            roleName: '护理员',\n            remark: '记录老人日常护理信息',\n            userCount: 8,\n            createTime: '2024-01-04 10:00:00',\n            permissions: [1, 11, 3, 31, 32]\n          },\n          {\n            id: 5,\n            roleName: '财务人员',\n            remark: '管理费用相关功能',\n            userCount: 2,\n            createTime: '2024-01-05 10:00:00',\n            permissions: [4, 41, 42, 43]\n          },\n          {\n            id: 6,\n            roleName: '前台接待',\n            remark: '负责老人入住登记',\n            userCount: 3,\n            createTime: '2024-01-06 10:00:00',\n            permissions: [1, 11, 12, 2, 21, 22]\n          }\n        ]\n        \n        roleList.value = mockData\n        total.value = mockData.length\n        loading.value = false\n      }, 500)\n    }\n    \n    // 搜索处理\n    const handleSearch = () => {\n      console.log('搜索条件:', searchForm)\n      getRoleList()\n    }\n    \n    // 重置搜索\n    const resetSearch = () => {\n      Object.keys(searchForm).forEach(key => {\n        searchForm[key] = ''\n      })\n      getRoleList()\n    }\n    \n    // 分页处理\n    const handleSizeChange = (size) => {\n      pagination.size = size\n      getRoleList()\n    }\n    \n    const handleCurrentChange = (page) => {\n      pagination.page = page\n      getRoleList()\n    }\n    \n    // 新增角色\n    const handleAdd = () => {\n      isEdit.value = false\n      dialogTitle.value = '新增角色'\n      // 重置表单\n      Object.keys(roleForm).forEach(key => {\n        roleForm[key] = ''\n      })\n      dialogVisible.value = true\n    }\n    \n    // 编辑角色\n    const handleEdit = (row) => {\n      isEdit.value = true\n      dialogTitle.value = '编辑角色'\n      // 填充表单数据\n      Object.keys(roleForm).forEach(key => {\n        roleForm[key] = row[key] || ''\n      })\n      dialogVisible.value = true\n    }\n    \n    // 查看角色详情\n    const handleView = (row) => {\n      currentRole.value = row\n      detailVisible.value = true\n    }\n    \n    // 删除角色\n    const handleDelete = async (row) => {\n      try {\n        await ElMessageBox.confirm(\n          `确定要删除角色 ${row.roleName} 吗？\\n注意：删除角色将影响该角色下的所有用户！`,\n          '警告',\n          {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }\n        )\n        \n        // 模拟删除操作\n        console.log('删除角色:', row)\n        ElMessage.success('删除成功')\n        getRoleList()\n      } catch (error) {\n        // 用户取消删除\n      }\n    }\n    \n    // 提交表单\n    const handleSubmit = async () => {\n      if (!roleFormRef.value) return\n      \n      try {\n        await roleFormRef.value.validate()\n        submitting.value = true\n        \n        // 模拟提交操作\n        console.log('提交角色信息:', roleForm)\n        await new Promise(resolve => setTimeout(resolve, 1000))\n        \n        ElMessage.success(isEdit.value ? '编辑成功' : '新增成功')\n        dialogVisible.value = false\n        getRoleList()\n      } catch (error) {\n        console.error('表单验证失败:', error)\n      } finally {\n        submitting.value = false\n      }\n    }\n    \n    // 关闭弹窗\n    const handleDialogClose = () => {\n      dialogVisible.value = false\n      if (roleFormRef.value) {\n        roleFormRef.value.clearValidate()\n      }\n    }\n    \n    // 组件挂载时获取数据\n    onMounted(() => {\n      getRoleList()\n    })\n    \n    return {\n      // 搜索表单\n      searchForm,\n      \n      // 分页\n      pagination,\n      total,\n      \n      // 表格\n      loading,\n      roleList,\n      \n      // 弹窗\n      dialogVisible,\n      dialogTitle,\n      detailVisible,\n      submitting,\n      isEdit,\n      \n      // 表单\n      roleForm,\n      roleRules,\n      roleFormRef,\n      \n      // 当前角色\n      currentRole,\n      \n      // 权限树\n      permissionTree,\n      treeProps,\n      \n      // 方法\n      handleSearch,\n      resetSearch,\n      handleSizeChange,\n      handleCurrentChange,\n      handleAdd,\n      handleEdit,\n      handleView,\n      handleDelete,\n      handleSubmit,\n      handleDialogClose,\n      \n      // 图标\n      Plus,\n      Search,\n      Edit,\n      Delete,\n      View\n    }\n  }\n}\n</script>\n\n<style scoped>\n.role-manage {\n  padding: 20px;\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.page-header h2 {\n  margin: 0;\n  color: #333;\n}\n\n.search-card {\n  margin-bottom: 20px;\n}\n\n.table-card {\n  min-height: 400px;\n}\n\n.table-header {\n  font-weight: bold;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  text-align: right;\n}\n\n.dialog-footer {\n  text-align: right;\n}\n\n.role-detail {\n  padding: 20px 0;\n}\n\n/* 响应式设计 */\n@media (max-width: 768px) {\n  .page-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 10px;\n  }\n  \n  .el-form-item {\n    width: 100%;\n  }\n  \n  .el-col {\n    width: 100%;\n    margin-bottom: 10px;\n  }\n  \n  .el-col:last-child {\n    margin-bottom: 0;\n  }\n}\n</style>